<div class="entry">
  <div class="row">
	<% if (item.feature ) { %>
           <% if (config.post_asset_folder){ %>
  	      <div class="thumbnail"><a href="<%- config.root %><%= item.path %>"><img src="<%= item.path %><%= item.feature %>" alt="<%= item.title %>"  class="nofancybox"></a>
           <% } else { %>
              <div class="thumbnail"><a href="<%- config.root %><%= item.path %>"><img src="<%= item.feature %>" alt="<%= item.title %>"  class="nofancybox"></a>
           <% } %>
		</div>
	<% } %>
    <% 
      var truncateLength = 300;
      var showMoreBtn = false;
      var showContent = '';
      var excerptEllipsis = '';
      // 关键：设置要保留的段落数
      var keepParagraphs = 4; 

      var rawContent = item.excerpt || item.content || '';
      var isHomePage = index || (page.type === 'index') || (page.type === 'archive');

      if (isHomePage) { // 主页只显示前4段
        // 按 </p> 分割HTML段落（Hexo解析Markdown后，段落对应 <p> 标签）
        var contentParagraphs = rawContent.split('</p>');
        // 过滤空段落，避免分割后出现空内容
        contentParagraphs = contentParagraphs.filter(p => p.trim().length > 0);

        if (contentParagraphs.length > keepParagraphs) {
          // 只保留前4段，并补全闭合 </p> 标签
          showContent = contentParagraphs.slice(0, keepParagraphs).join('</p>') + '</p>';
          showMoreBtn = true;
          excerptEllipsis = '<span class="excerpt-ellipsis">...</span>';
        } else {
          // 不足4段，显示全部内容
          showContent = rawContent;
          showMoreBtn = false;
        }
        // 拼接内容和缺省标识
        showContent += excerptEllipsis;
      } else { // 详情页显示全文
        showContent = item.content || '';
        showMoreBtn = false;
      }

      // 最终兜底
      if (!showContent || showContent.length === 0) {
        showContent = '<p>这个博主很懒，居然新建文件之后就不管了(╯‵□′)╯︵┻━┻</p>';
      }
    %>
    <!-- 渲染内容 + 缺省标识 -->
    <%- showContent %>
	</div>
  
  <!-- 保留按钮逻辑 -->
  <% if (showMoreBtn) { %>
    <a type="button" href="<%- config.root %><%- item.path %>" class="btn btn-default more"><%= __('read_more') %></a>
  <% } %>
</div>